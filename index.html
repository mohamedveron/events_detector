<!DOCTYPE html>
<html>
<head>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

    <style type="text/css">
        body {
            padding-top: 40px;
            padding-bottom: 40px;
            background-color: #eee;
        }

        .form-details {
            max-width: 330px;
            padding: 15px;
            margin: 0 auto;
        }
        .form-details .form-details-heading,
        .form-details .checkbox {
            margin-bottom: 10px;
        }
        .form-details .checkbox {
            font-weight: normal;
        }
        .form-details .form-control {
            position: relative;
            height: auto;
            padding: 10px;
            font-size: 16px;
        }
        .form-details .form-control:focus {
            z-index: 2;
        }
    </style>
</head>
<body>

<div class="container">

    <form id="form" class="form-details" method="post">

        <h2 class="form-details-heading">Details</h2>

        <label for="inputEmail" class="sr-only">Email address</label>
        <input type="email" id="inputEmail" class="form-control"
               placeholder="Email address" onKeyUp="setStartTimestamp()" onpaste="copyPasteTrigger('inputEmail')" required autofocus>

        <label for="inputCardNumber" class="sr-only">Card Number</label>
        <input type="text" id="inputCardNumber" class="form-control"
               placeholder="Card Number" onKeyUp="setStartTimestamp()" onpaste="copyPasteTrigger('inputCardNumber')" required>

        <label for="inputCVV" class="sr-only">CVV</label>
        <input type="text" id="inputCVV" class="form-control"
               placeholder="Security Code" onKeyUp="setStartTimestamp()" onpaste="copyPasteTrigger('inputCVV')" required>

        <div class="checkbox">
            <label>
                <input type="checkbox" value="agree"> Agree to Terms
            </label>
        </div>

        <button class="btn btn-lg btn-primary btn-block" type="submit">Submit</button>
    </form>

</div> <!-- /container -->

</body>

<script>

    const websiteUrl = window.location.href;
    console.log(websiteUrl);

    function makeid(length) {
        let result           = '';
        let characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let charactersLength = characters.length;
        for ( let i = 0; i < length; i++ ) {
            result += characters.charAt(Math.floor(Math.random() *
                charactersLength));
        }
        return result;
    }

    const sessionId = makeid(16);


    function copyPasteTrigger(inputId) {
        console.log("Sending copy paste event");

        const payload = {
            "eventType": "copyAndPaste",
            "websiteUrl": websiteUrl,
            "sessionId": sessionId,
            "formId": inputId,
            "pasted": true
        }

        sendRequest(payload);
    }

    /*
        * helper method send
        */
    function sendRequest(payload) {

        const stringPayload = JSON.stringify(payload);
        const url = "/event"
        fetch(url, {
            method: 'post',
            body: stringPayload,
        }).then(response => {
            if (!response.ok) {
                throw Error(response.statusText);
            }
        }).catch(error => {
            console.log(error);
        });
    }
</script>
</html>